{"version":3,"sources":["../src/index.ts","../src/normalize-props.ts","../src/portal.ts","../src/use-layout-effect.ts","../src/use-snapshot.ts","../src/use-actor.ts","../src/use-constant.ts","../src/use-machine.ts"],"sourcesContent":["export { mergeProps } from \"@zag-js/core\"\nexport type { ContextFrom, EventFrom, StateFrom } from \"@zag-js/core\"\nexport * from \"./normalize-props\"\nexport { Portal } from \"./portal\"\nexport type { PortalProps } from \"./portal\"\nexport * from \"./use-actor\"\nexport * from \"./use-machine\"\n","import { createNormalizer } from \"@zag-js/types\"\nimport type { HTMLAttributes, CSSProperties } from \"react\"\n\ntype WithoutRef<T> = Omit<T, \"ref\">\n\ntype ElementsWithoutRef = {\n  [K in keyof JSX.IntrinsicElements]: WithoutRef<JSX.IntrinsicElements[K]>\n}\n\nexport type PropTypes = ElementsWithoutRef & {\n  element: WithoutRef<HTMLAttributes<HTMLElement>>\n  style: CSSProperties\n}\n\nexport const normalizeProps = createNormalizer<PropTypes>((v) => v)\n","import { createElement, useReducer, useRef } from \"react\"\nimport { createPortal } from \"react-dom\"\nimport { useSafeLayoutEffect } from \"./use-layout-effect\"\n\nexport type PortalProps = {\n  children: React.ReactNode\n  target?: React.RefObject<HTMLElement>\n}\n\nexport function Portal(props: PortalProps): JSX.Element {\n  const { children, target } = props\n  const node = useRef<HTMLDivElement | null>(null)\n  const portalNode = useRef<HTMLElement | null>(null)\n  const [, forceUpdate] = useReducer((s) => s + 1, 0)\n\n  useSafeLayoutEffect(() => {\n    if (!node.current) return\n    const doc = node.current.ownerDocument\n    portalNode.current = doc.createElement(\"zag-portal\")\n    doc.body.appendChild(portalNode.current)\n\n    forceUpdate()\n\n    return () => {\n      if (portalNode.current) {\n        doc.body.removeChild(portalNode.current)\n      }\n    }\n  }, [])\n\n  const targetNode = target?.current ?? portalNode.current\n\n  if (targetNode) {\n    return createPortal(children as any, targetNode)\n  }\n\n  return createElement(\"span\", { ref: node })\n}\n","import { useEffect, useLayoutEffect } from \"react\"\n\nexport const useSafeLayoutEffect = typeof document !== \"undefined\" ? useLayoutEffect : useEffect\n","/// <reference types=\"react/experimental\" />\n\nimport { snapshot, subscribe, type Snapshot } from \"@zag-js/store\"\nimport { createProxy as createProxyToCompare, isChanged } from \"proxy-compare\"\nimport ReactExports, { useCallback, useEffect, useMemo, useRef, useSyncExternalStore } from \"react\"\n\nconst { use } = ReactExports\n\ntype Options = {\n  sync?: boolean\n}\n\nconst targetCache = new WeakMap()\n\nexport function useSnapshot<T extends object>(proxyObject: T, options?: Options): Snapshot<T> {\n  const notifyInSync = options?.sync\n  const lastSnapshot = useRef<Snapshot<T>>()\n  const lastAffected = useRef<WeakMap<object, unknown>>()\n\n  const currSnapshot = useSyncExternalStore(\n    useCallback(\n      (callback) => {\n        const unsub = subscribe(proxyObject, callback, notifyInSync)\n        callback()\n        return unsub\n      },\n      [proxyObject, notifyInSync],\n    ),\n    () => {\n      const nextSnapshot = snapshot(proxyObject, use)\n      try {\n        if (\n          lastSnapshot.current &&\n          lastAffected.current &&\n          !isChanged(lastSnapshot.current, nextSnapshot, lastAffected.current, new WeakMap())\n        ) {\n          return lastSnapshot.current\n        }\n      } catch (e) {\n        // ignore if a promise or something is thrown\n      }\n      return nextSnapshot\n    },\n    () => snapshot(proxyObject, use),\n  )\n  const currAffected = new WeakMap()\n  useEffect(() => {\n    lastSnapshot.current = currSnapshot\n    lastAffected.current = currAffected\n  })\n  const proxyCache = useMemo(() => new WeakMap(), []) // per-hook proxyCache\n  return createProxyToCompare(currSnapshot, currAffected, proxyCache, targetCache)\n}\n","import type { Machine, StateMachine as S } from \"@zag-js/core\"\nimport { useSnapshot } from \"./use-snapshot\"\n\nexport function useActor<\n  TContext extends Record<string, any>,\n  TState extends S.StateSchema,\n  TEvent extends S.EventObject = S.AnyEventObject,\n>(service: Machine<TContext, TState, TEvent>) {\n  const current = useSnapshot(service.state)\n  const typedState = current as unknown as S.State<TContext, TState, TEvent>\n  return [typedState, service.send] as const\n}\n","import { useRef } from \"react\"\n\nexport function useConstant<T>(fn: () => T): T {\n  const ref = useRef<{ v: T }>()\n  if (!ref.current) ref.current = { v: fn() }\n  return ref.current.v\n}\n","import type { MachineSrc, StateMachine as S } from \"@zag-js/core\"\nimport { useConstant } from \"./use-constant\"\nimport { useSafeLayoutEffect } from \"./use-layout-effect\"\nimport { useSnapshot } from \"./use-snapshot\"\n\nexport function useService<\n  TContext extends Record<string, any>,\n  TState extends S.StateSchema,\n  TEvent extends S.EventObject = S.AnyEventObject,\n>(machine: MachineSrc<TContext, TState, TEvent>, options?: S.HookOptions<TContext, TState, TEvent>) {\n  const { actions, state: hydratedState, context } = options ?? {}\n\n  const service = useConstant(() => {\n    const instance = typeof machine === \"function\" ? machine() : machine\n    return context ? instance.withContext(context) : instance\n  })\n\n  useSafeLayoutEffect(() => {\n    service.start(hydratedState)\n\n    if (service.state.can(\"SETUP\")) {\n      service.send(\"SETUP\")\n    }\n\n    return () => {\n      service.stop()\n    }\n  }, [])\n\n  service.setOptions({ actions })\n  service.setContext(context)\n\n  return service\n}\n\nexport function useMachine<\n  TContext extends Record<string, any>,\n  TState extends S.StateSchema,\n  TEvent extends S.EventObject = S.AnyEventObject,\n>(machine: MachineSrc<TContext, TState, TEvent>, options?: S.HookOptions<TContext, TState, TEvent>) {\n  const service = useService(machine, options)\n\n  const state = useSnapshot(service.state)\n  const typedState = state as unknown as S.State<TContext, TState, TEvent>\n  return [typedState, service.send, service] as const\n}\n"],"mappings":"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","names":["useEffect","useRef","useRef"]}